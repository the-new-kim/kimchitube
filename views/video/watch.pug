extends ../base
include ../mixins/avatar
include ../mixins/video
include ../mixins/like

block body
    div.video__container
        div.video__main
            div#videoPlayer(data-id=video._id)
                video(src=isHeroku ? video.fileUrl : "/" + video.fileUrl, crossorigin)

                div#videoControls.videoControls
                    div.videoControls__play
                        span#play.videoControls__playBtn
                            i.fas.fa-play
                        div.videoControls__time
                            span#currentTime 00:00
                            span  / 
                            span#totalTime 00:00
                    input(type="range",step="1", value="0", min="0")#timeline.videoControls__timeline
                    div.videoControls__volume
                        input(type="range",step="0.1", value=0.5, min="0", max="1")#volume
                        span#mute
                            i.fas.fa-volume-up
                        span#fullScreen
                            i.fas.fa-expand

            //- p=video.description
            //- small uploaded by 
            //-     a(href=`/user/${video.owner._id}`)=video.owner.name
            //- hr

            div.video__data
                ul.video__hash-tags
                    each tag in video.hashtags
                        li
                            a(href=`/search?keyword=${tag.replace("#","")}`)=tag
                p.video__title=video.title
                div.video__meta-and-likes
                    small.video__meta
                        span #{video.meta.views} #{video.meta.views > 1 ? "Views " : "View "}
                        span Â· 
                        span=new Date(video.createdAt).toLocaleDateString("us-en", {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'})

                    span.video__likes.videoLikesContainer
                        +like(video)
                hr

                .video__owner-and-description
                    a(href=`/user/${video.owner._id}`).video__owner-avatar
                        div.avatar.avatar__sm
                            +avatar(video.owner)
                    h3.video__owner-name
                        a(href=`/user/${video.owner._id}`)=video.owner.name
                    p.video__desciprtion=video.description
                
                
                if loggedIn && video.owner._id + "" === loggedInUser._id + ""
                    div.video__admin
                        a(href=`${video.id}/edit`) Edit
                        a(href=`${video.id}/delete`) Delete    
            
            
            
            if loggedIn
                div.video__add-comments
                    div.avatar.avatar__sm
                        +avatar(loggedInUser)
                    form.video__comment-form#commentForm(data-logged-in-user=loggedInUser.name)
                        input.video__comment-input(type="text" placeholder="Write a nice commment..." required)
                        button Add Comment

            div.video__comments__container
                div.video__comments-total
                    span.commentsTotal=video.comments.length
                    span.commentsText #{video.comments.length > 1 ? " Comments" : " Comment"}
                ul.video__comments
                    each comment in video.comments.reverse()
                        li.video__comment(data-comment-id=comment._id)
                            div.avatar.avatar__sm
                                    a(href=`/user/${comment.owner._id}`)
                                        +avatar(comment.owner)
                            div.video__comment__main
                                
                                a(href=`/user/${comment.owner._id}`)=comment.owner.name
                                p=comment.text
                                div.video__comment__buttons
                                    +like(comment)
                                    if loggedIn && loggedInUser._id + "" === comment.owner._id + ""
                                        i.deleteButton.fa-solid.fa-trash

        ul.related-videos.video-flex-col 
            each video in relatedVideos
                +video(video, videoMixinTypes.related)
            else
                span.empty__message No videos found 
    
    
block scripts
    script(src="/static/js/videoPlayer.js")
    if loggedIn
        script(src="/static/js/commentSection.js") 
        script(src="/static/js/likeVideo.js") 